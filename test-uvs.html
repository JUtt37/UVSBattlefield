<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UVS Game Engine Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a1a; 
            color: white; 
            padding: 20px; 
        }
        .test-container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: #2a2a2a; 
            padding: 20px; 
            border-radius: 10px; 
        }
        button { 
            background: #e74c3c; 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            margin: 5px; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        button:hover { background: #c0392b; }
        button:disabled { background: #7f8c8d; cursor: not-allowed; }
        .log { 
            background: #333; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px 0; 
            max-height: 300px; 
            overflow-y: auto; 
        }
        .player-info { 
            background: #444; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .game-board {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .player-board {
            background: #555;
            padding: 15px;
            border-radius: 8px;
        }
        .zone {
            background: #666;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            min-height: 40px;
        }
        .zone-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .card {
            background: #fff;
            color: #333;
            padding: 5px;
            margin: 2px;
            border-radius: 3px;
            font-size: 12px;
            display: inline-block;
            cursor: pointer;
        }
        .card:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
        }
        .hand-area {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ü•ä UVS Game Engine Test</h1>
        
        <div>
            <button onclick="testEngine.startNewGame()">Start New Game</button>
            <button onclick="testEngine.nextPhase()">Next Phase</button>
            <button onclick="testEngine.endTurn()">End Turn</button>
            <button onclick="testEngine.drawCard()">Draw Card</button>
        </div>
        
        <div class="game-board">
            <div class="player-board">
                <h3>Player 1 (Active)</h3>
                <div class="zone">
                    <div class="zone-label">Life: <span id="p1-life">25</span></div>
                </div>
                <div class="zone">
                    <div class="zone-label">Hand (<span id="p1-hand-count">0</span>):</div>
                    <div id="p1-hand"></div>
                </div>
                <div class="zone">
                    <div class="zone-label">Card Pool (<span id="p1-pool-count">0</span>/7):</div>
                    <div id="p1-cardpool"></div>
                </div>
                <div class="zone">
                    <div class="zone-label">Stage:</div>
                    <div id="p1-stage"></div>
                </div>
                <div class="zone">
                    <div class="zone-label">Momentum: <span id="p1-momentum">0</span></div>
                </div>
            </div>
            
            <div class="player-board">
                <h3>Player 2</h3>
                <div class="zone">
                    <div class="zone-label">Life: <span id="p2-life">25</span></div>
                </div>
                <div class="zone">
                    <div class="zone-label">Hand (<span id="p2-hand-count">0</span>):</div>
                    <div id="p2-hand"></div>
                </div>
                <div class="zone">
                    <div class="zone-label">Card Pool (<span id="p2-pool-count">0</span>/7):</div>
                    <div id="p2-cardpool"></div>
                </div>
                <div class="zone">
                    <div class="zone-label">Stage:</div>
                    <div id="p2-stage"></div>
                </div>
                <div class="zone">
                    <div class="zone-label">Momentum: <span id="p2-momentum">0</span></div>
                </div>
            </div>
        </div>
        
        <div class="player-info" id="player-info">
            <h3>Game State</h3>
            <div id="game-state">No game started</div>
        </div>
        
        <div class="log" id="game-log">
            <h3>Game Log</h3>
            <div id="log-content">Ready to test UVS game engine...</div>
        </div>
    </div>

    <div class="hand-area" id="hand-area" style="display: none;">
        <h4>Your Hand:</h4>
        <div id="hand-cards"></div>
    </div>

    <script>
        class TestEngine {
            constructor() {
                this.gameState = {
                    activePlayer: 0,
                    phase: 'setup',
                    turnNumber: 1,
                    gameOver: false,
                    winner: null
                };
                this.players = [
                    { 
                        id: 0, 
                        name: 'Player 1', 
                        life: 25, 
                        hand: [], 
                        deck: [], 
                        cardPool: [], 
                        stage: [],
                        momentum: [],
                        discard: [],
                        hasDrawnThisTurn: false,
                        hasPlayedCardThisTurn: false
                    },
                    { 
                        id: 1, 
                        name: 'Player 2', 
                        life: 25, 
                        hand: [], 
                        deck: [], 
                        cardPool: [], 
                        stage: [],
                        momentum: [],
                        discard: [],
                        hasDrawnThisTurn: false,
                        hasPlayedCardThisTurn: false
                    }
                ];
                this.eventLog = [];
                this.gameStarted = false;
            }

            startNewGame() {
                this.gameState.phase = 'start';
                this.gameState.turnNumber = 1;
                this.gameState.activePlayer = 0;
                this.gameStarted = true;
                
                this.players.forEach((player, i) => {
                    player.hand = [
                        { id: `focus_${i}`, name: 'Focus', type: 'Foundation', difficulty: 2, check: 3 },
                        { id: `hadoken_${i}`, name: 'Hadoken', type: 'Attack', difficulty: 2, damage: 4, speed: 3, zone: 'Mid', check: 3 },
                        { id: `training_${i}`, name: 'Training', type: 'Foundation', difficulty: 1, check: 2 },
                        { id: `kikoken_${i}`, name: 'Kikoken', type: 'Attack', difficulty: 2, damage: 3, speed: 2, zone: 'High', check: 3 },
                        { id: `gi_${i}`, name: 'Gi', type: 'Asset', difficulty: 1, check: 2 }
                    ];
                    player.deck = Array.from({length: 50}, (_, j) => ({
                        id: `deck_${i}_${j}`, name: 'Deck Card', type: 'Card', check: Math.floor(Math.random() * 5) + 1
                    }));
                });
                
                this.logEvent('ü•ä New UVS game started!');
                this.logEvent('üë§ Players: Ryu vs Chun-Li');
                this.logEvent(' Decks shuffled and hands drawn');
                this.updateDisplay();
            }

            nextPhase() {
                if (!this.gameStarted) return;
                
                const phases = ['start', 'combat', 'end'];
                const currentIndex = phases.indexOf(this.gameState.phase);
                const nextIndex = (currentIndex + 1) % phases.length;
                this.gameState.phase = phases[nextIndex];
                
                this.logEvent(`Phase: ${this.gameState.phase}`);
                
                if (this.gameState.phase === 'start') {
                    this.handleStartPhase();
                } else if (this.gameState.phase === 'end') {
                    this.handleEndPhase();
                }
                
                this.updateDisplay();
            }

            handleStartPhase() {
                const player = this.players[this.gameState.activePlayer];
                
                if (this.gameState.turnNumber === 1 && this.gameState.activePlayer === 0) {
                    this.logEvent('‚è≠Ô∏è First player skips Start Phase on first turn');
                    return;
                }
                
                this.logEvent('üîÑ Ready Step: All stage cards become ready');
                this.logEvent('üëÄ Review Step: Player may discard 1 card');
                this.handleDrawStep();
            }

            handleDrawStep() {
                const player = this.players[this.gameState.activePlayer];
                
                const cardsToDraw = 7 - player.hand.length;
                for (let i = 0; i < cardsToDraw; i++) {
                    if (player.deck.length > 0) {
                        const card = player.deck.pop();
                        player.hand.push(card);
                        this.logEvent(` Player ${this.gameState.activePlayer + 1} draws a card`);
                    }
                }
                
                if (this.gameState.turnNumber === 1 && this.gameState.activePlayer === 1) {
                    if (player.deck.length > 0) {
                        const card = player.deck.pop();
                        player.hand.push(card);
                        this.logEvent('üìñ Second player draws additional card on first turn');
                    }
                }
                
                player.hasDrawnThisTurn = true;
            }

            handleEndPhase() {
                this.logEvent('üèÅ End Phase: Clearing card pools');
                this.clearCardPools();
            }

            clearCardPools() {
                this.players.forEach(player => {
                    const cards = [...player.cardPool];
                    player.cardPool = [];
                    
                    for (let i = cards.length - 1; i >= 0; i--) {
                        const card = cards[i];
                        if (card.type === 'Foundation' || card.type === 'Asset') {
                            player.stage.push(card);
                            this.logEvent(`üèóÔ∏è ${card.name} builds to stage`);
                        } else if (card.type === 'Attack') {
                            if (card.dealtDamage) {
                                player.momentum.push(card);
                                this.logEvent(` ${card.name} added to momentum (dealt damage)`);
                            } else {
                                player.discard.push(card);
                                this.logEvent(`üóëÔ∏è ${card.name} discarded (no damage dealt)`);
                            }
                        } else {
                            player.discard.push(card);
                            this.logEvent(`üóëÔ∏è ${card.name} discarded`);
                        }
                    }
                });
            }

            endTurn() {
                if (!this.gameStarted) return;
                
                this.gameState.activePlayer = 1 - this.gameState.activePlayer;
                this.gameState.turnNumber++;
                this.gameState.phase = 'start';
                
                this.players.forEach(player => {
                    player.hasDrawnThisTurn = false;
                    player.hasPlayedCardThisTurn = false;
                });
                
                this.players[this.gameState.activePlayer].momentum.push({ id: 'momentum', name: 'Momentum' });
                
                this.logEvent(` Turn ended. Player ${this.gameState.activePlayer + 1}'s turn begins.`);
                this.updateDisplay();
            }

            drawCard() {
                if (!this.gameStarted) return;
                
                const player = this.players[this.gameState.activePlayer];
                if (this.gameState.phase !== 'start') {
                    this.logEvent('‚ùå Can only draw during Start Phase');
                    return;
                }
                
                if (player.hasDrawnThisTurn) {
                    this.logEvent('‚ùå Already drawn this turn');
                    return;
                }
                
                if (player.deck.length > 0) {
                    const card = player.deck.pop();
                    player.hand.push(card);
                    player.hasDrawnThisTurn = true;
                    this.logEvent(` Player ${this.gameState.activePlayer + 1} draws a card`);
                    this.updateDisplay();
                } else {
                    this.logEvent('‚ùå Deck is empty');
                }
            }

            playCard(cardId) {
                if (!this.gameStarted) return;
                
                const player = this.players[this.gameState.activePlayer];
                if (this.gameState.phase !== 'combat') {
                    this.logEvent('‚ùå Can only play cards during Combat Phase');
                    return;
                }
                
                if (player.hasPlayedCardThisTurn) {
                    this.logEvent('‚ùå Already played a card this turn');
                    return;
                }
                
                if (player.cardPool.length >= 7) {
                    this.logEvent('‚ùå Card pool is full (max 7 cards)');
                    return;
                }
                
                const cardIndex = player.hand.findIndex(card => card.id === cardId);
                if (cardIndex === -1) {
                    this.logEvent('‚ùå Card not found in hand');
                    return;
                }
                
                const card = player.hand.splice(cardIndex, 1)[0];
                const progressiveDifficulty = player.cardPool.length;
                const totalDifficulty = card.difficulty + progressiveDifficulty;
                
                this.logEvent(` Attempting to play ${card.name}: Difficulty ${card.difficulty} + Progressive ${progressiveDifficulty} = Total ${totalDifficulty}`);
                
                if (player.deck.length > 0) {
                    const checkCard = player.deck.pop();
                    player.discard.push(checkCard);
                    
                    if (checkCard.check >= totalDifficulty) {
                        player.cardPool.push(card);
                        player.hasPlayedCardThisTurn = true;
                        this.logEvent(`‚úÖ Successfully played ${card.name} (Check: ${checkCard.check} >= ${totalDifficulty})`);
                    } else {
                        player.discard.push(card);
                        this.logEvent(`‚ùå Failed to play ${card.name} (Check: ${checkCard.check} < ${totalDifficulty})`);
                    }
                } else {
                    player.discard.push(card);
                    this.logEvent('‚ùå Failed to play card (deck empty)');
                }
                
                this.updateDisplay();
            }

            logEvent(message) {
                const timestamp = new Date().toLocaleTimeString();
                this.eventLog.push(`[${timestamp}] ${message}`);
                if (this.eventLog.length > 20) {
                    this.eventLog = this.eventLog.slice(-20);
                }
                this.updateLog();
            }

            updateDisplay() {
                const gameStateDiv = document.getElementById('game-state');
                gameStateDiv.innerHTML = `
                    <strong>Active Player:</strong> ${this.gameState.activePlayer + 1}<br>
                    <strong>Phase:</strong> ${this.gameState.phase}<br>
                    <strong>Turn:</strong> ${this.gameState.turnNumber}
                `;
                
                this.players.forEach((player, i) => {
                    const prefix = `p${i + 1}`;
                    
                    document.getElementById(`${prefix}-life`).textContent = player.life;
                    document.getElementById(`${prefix}-momentum`).textContent = player.momentum.length;
                    document.getElementById(`${prefix}-hand-count`).textContent = player.hand.length;
                    document.getElementById(`${prefix}-pool-count`).textContent = player.cardPool.length;
                    
                    this.updateZoneDisplay(`${prefix}-hand`, player.hand, i);
                    this.updateZoneDisplay(`${prefix}-cardpool`, player.cardPool, i);
                    this.updateZoneDisplay(`${prefix}-stage`, player.stage, i);
                });
                
                this.updateHandDisplay();
            }

            updateZoneDisplay(zoneId, cards, playerId) {
                const zone = document.getElementById(zoneId);
                zone.innerHTML = '';
                cards.forEach(card => {
                    const cardEl = document.createElement('div');
                    cardEl.className = 'card';
                    cardEl.textContent = card.name;
                    if (playerId === this.gameState.activePlayer && zoneId.includes('hand')) {
                        cardEl.addEventListener('click', () => this.playCard(card.id));
                    }
                    zone.appendChild(cardEl);
                });
            }

            updateHandDisplay() {
                const handArea = document.getElementById('hand-area');
                const handCards = document.getElementById('hand-cards');
                const activePlayer = this.players[this.gameState.activePlayer];
                
                if (this.gameStarted && activePlayer.hand.length > 0) {
                    handArea.style.display = 'flex';
                    handCards.innerHTML = '';
                    
                    activePlayer.hand.forEach(card => {
                        const cardEl = document.createElement('div');
                        cardEl.className = 'card';
                        cardEl.textContent = card.name;
                        cardEl.addEventListener('click', () => this.playCard(card.id));
                        handCards.appendChild(cardEl);
                    });
                } else {
                    handArea.style.display = 'none';
                }
            }

            updateLog() {
                const logContent = document.getElementById('log-content');
                logContent.innerHTML = this.eventLog.map(event => 
                    `<div style="margin-bottom: 3px; padding: 2px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">${event}</div>`
                ).join('');
                logContent.scrollTop = logContent.scrollHeight;
            }
        }

        const testEngine = new TestEngine();
    </script>
</body>
</html>